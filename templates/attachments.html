{{define "attachments"}}
<div class="h-full flex flex-row">
    <!-- Sidebar -->
    <div class="sidebar flex flex-col w-64 border-r border-gray-200 bg-gray-50">
        <div class="p-4 border-b border-gray-200 flex items-center justify-between">
            <h2 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">{{t "nav_folders"}}</h2>
        </div>
        <div class="flex-1 overflow-y-auto folder-nav">
            <ul class="space-y-1 folder-list">
                {{$current := .CurrentFolder}}
                {{range .Folders}}
                <li>
                    <a href="/attachments?folder={{.Name}}"
                        class="folder-item {{if eq .Name $current}}active{{end}} block px-4 py-2 text-sm rounded-md"
                        style="display: flex; justify-content: space-between; align-items: center;">
                        <span class="truncate">{{.Name}}</span>
                        {{if gt .Unread 0}}
                        <span
                            class="inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 bg-red-600 rounded-full">{{.Unread}}</span>
                        {{end}}
                    </a>
                </li>
                {{end}}
            </ul>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col bg-white overflow-hidden">
        <!-- Header -->
        <div class="border-b border-gray-200 px-6 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-gray-900">{{t "nav_attachments"}} - {{.CurrentFolder}}</h1>

            <!-- Pagination Controls -->
            <div class="flex items-center space-x-2">
                {{if .HasPrev}}
                <a href="/attachments?folder={{.CurrentFolder}}&page={{minus .Page 1}}"
                    class="px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-600 hover:bg-gray-50">
                    &larr; {{t "pagination_prev"}}
                </a>
                {{end}}

                <span class="text-sm text-gray-500">{{t "pagination_page"}} {{.Page}}</span>

                {{if .HasNext}}
                <a href="/attachments?folder={{.CurrentFolder}}&page={{plus .Page 1}}"
                    class="px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-600 hover:bg-gray-50">
                    {{t "pagination_next"}} &rarr;
                </a>
                {{end}}
            </div>
        </div>

        <!-- Attachment Grid -->
        <div class="flex-1 overflow-y-auto p-6">
            {{if .Attachments}}
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                {{range .Attachments}}
                <div
                    class="border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition-shadow bg-white flex flex-col">
                    <!-- Preview Area -->
                    <div class="h-40 bg-gray-100 flex items-center justify-center overflow-hidden relative group">
                        {{if .IsImage}}
                        <img src="/api/attachments/{{.EmailID}}/{{.Index}}/preview?folder={{$.CurrentFolder}}"
                            alt="{{.Filename}}" class="w-full h-full object-cover">
                        {{else}}
                        <div class="text-gray-400">
                            <!-- File Icon -->
                            <svg class="w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                    d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                            </svg>
                        </div>
                        <span
                            class="absolute bottom-2 right-2 px-2 py-1 bg-gray-800 bg-opacity-75 text-white text-xs rounded">
                            {{.ContentType}}
                        </span>
                        {{end}}
                    </div>

                    <!-- Info Area -->
                    <div class="p-4 flex-1 flex flex-col justify-between">
                        <div>
                            <h3 class="text-sm font-medium text-gray-900 truncate" title="{{.Filename}}">{{.Filename}}
                            </h3>
                            <p class="text-xs text-gray-500 mt-1">{{formatSize .Size}}</p>
                        </div>

                        <div class="mt-4 pt-3 border-t border-gray-100">
                            <p class="text-xs text-gray-400 mb-2 truncate">
                                From: {{.EmailFrom}}
                            </p>
                            <div class="flex justify-between items-center">
                                <a href="/inbox?folder={{$.CurrentFolder}}&id={{.EmailID}}"
                                    class="text-xs text-blue-600 hover:text-blue-800 hover:underline">
                                    {{t "view_email"}}
                                </a>
                                <a href="/api/attachments/{{.EmailID}}/{{.Index}}/download?folder={{$.CurrentFolder}}"
                                    download="{{.Filename}}" class="text-gray-500 hover:text-gray-700" title="{{t "
                                    download"}}">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {{end}}
            </div>
            {{else}}
            <div class="h-full flex flex-col items-center justify-center text-gray-500">
                <svg class="w-16 h-16 mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
                </svg>
                <p class="text-lg">{{t "attachments_none"}}</p>
            </div>
            {{end}}
        </div>
    </div>
</div>

<script>
    // Simple helper to persist scroll or handle errors
    document.addEventListener('DOMContentLoaded', () => {
        // Maybe add lightbox functionality in the future
    });
</script>
{{end}}